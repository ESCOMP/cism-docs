

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>6. Frequently Asked Questions &#8212; cismdoc  documentation</title>
    <link rel="stylesheet" href="../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7. Acknowledgments" href="acknowledgements.html" />
    <link rel="prev" title="5. Ice sheets in the Community Land Model" href="ice-sheets-in-clm.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="acknowledgements.html" title="7. Acknowledgments"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ice-sheets-in-clm.html" title="5. Ice sheets in the Community Land Model"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">cismdoc  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">CISM User’s Guide</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">6. Frequently Asked Questions</a><ul>
<li><a class="reference internal" href="#how-do-i-run-an-ensemble-of-ice-sheets-which-differ-in-their-parameters-initial-conditions-and-or-forcing-data">6.1. How do I run an ensemble of ice sheets, which differ in their parameters, initial conditions, and/or forcing data?</a></li>
<li><a class="reference internal" href="#how-do-i-initialize-each-ensemble-member-with-a-different-restart-file">6.2. How do I initialize each ensemble member with a different restart file?</a></li>
<li><a class="reference internal" href="#how-do-i-use-different-forcing-data-for-each-cism-ensemble-member-in-a-tg-compset">6.3. How do I use different forcing data for each CISM ensemble member in a TG compset?</a></li>
<li><a class="reference internal" href="#how-do-i-force-each-ensemble-member-with-a-different-set-of-years">6.4. How do I force each ensemble member with a different set of years?</a></li>
<li><a class="reference internal" href="#how-do-i-run-clm-with-something-other-than-10-elevation-classes-and-or-how-do-i-create-a-clm4-5-surface-dataset-that-is-consistent-with-cism-over-greenland">6.5. How do I run CLM with something other than 10 elevation classes, and/or how do I create a CLM4.5 surface dataset that is consistent with CISM over Greenland?</a></li>
<li><a class="reference internal" href="#how-do-i-add-new-settings-in-cism-s-namelist-or-config-file">6.6. How do I add new settings in CISM’s namelist or config file?</a></li>
<li><a class="reference internal" href="#how-do-i-output-forcing-fields-sent-from-clm-to-cism">6.7. How do I output forcing fields sent from CLM to CISM?</a></li>
<li><a class="reference internal" href="#how-do-i-add-a-clm-history-field-that-provides-averages-only-over-ice">6.8. How do I add a CLM history field that provides averages only over ice?</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ice-sheets-in-clm.html"
                        title="previous chapter">5. Ice sheets in the Community Land Model</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="acknowledgements.html"
                        title="next chapter">7. Acknowledgments</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/users_guide/faqs.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="frequently-asked-questions">
<span id="faqs"></span><h1>6. Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h1>
<p>This section answers some miscellaneous questions about ice sheet
modeling within CESM.</p>
<div class="section" id="how-do-i-run-an-ensemble-of-ice-sheets-which-differ-in-their-parameters-initial-conditions-and-or-forcing-data">
<h2>6.1. How do I run an ensemble of ice sheets, which differ in their parameters, initial conditions, and/or forcing data?<a class="headerlink" href="#how-do-i-run-an-ensemble-of-ice-sheets-which-differ-in-their-parameters-initial-conditions-and-or-forcing-data" title="Permalink to this headline">¶</a></h2>
<p>Starting with CESM1.1, it is possible to run an ensemble of any model
component(s) within a single CESM executable. Thus, you have a single
case directory and a single run directory, but with separate input and
output files for each ensemble member. In much of the CESM
documentation, this capability is referred to as “multi-instance”. But
here we refer to it as “multiple ensemble members” to avoid confusion
with CISM’s capability to run multiple ice sheets (e.g., Greenland and
Antarctica), which is also referred to as multiple instances.</p>
<p>An ensemble can be used in a TG compset to run multiple versions of
CISM, either forced by the same data or each forced by different data.
An ensemble can also be used in a coupled configuration (IG, FG or BG
compsets). In this case, a requirement is that if there are N ensemble
members of any one active component, then there must be N ensemble
members of ALL active components. For example, in an IG compset, if you
want to run with 32 CISM ensemble members, then you must also have 32
CLM ensemble members, where CLM #1 will be coupled to CISM #1, etc. In
this case, you could choose to have either a single data atmosphere, or
32 data atmospheres, each providing their own forcing to one of the 32
CLMs.</p>
<p>Note that different ensemble members can ONLY differ in namelist /
configuration settings and initial conditions / restart files –&nbsp;they are
all using the same model executable.</p>
<p>The use of the ensemble capability is as follows; this assumes you are
running a TG compset:</p>
<ol class="arabic simple">
<li>Create the case, as normal.</li>
<li>Modify <em>env_mach_pes.xml</em>:<ol class="loweralpha">
<li>Specify the desired number of CISM ensemble members by modifying
<a href="#id1"><span class="problematic" id="id2">*</span></a>NINST_GLC. *</li>
<li>Also change <em>NTASKS_GLC</em> to this same value: this specifies the
total number of GLC tasks, which are divided among the N ensemble
members.</li>
<li>If you want to use separate forcing data for each ensemble member,
then also modify <em>NINST_LND</em> and <em>NTASKS_LND</em> similarly, in
order to run with a separate data land model for each CISM
ensemble member. (See below for more details on how to use
different forcing data for each ensemble member.)</li>
<li>Probably also change <em>NTASKS_CPL</em> to be equal to <em>NTASKS_GLC</em>,
although for large ensembles you may want to experiment with a few
different values of this variable to obtain the best performance.</li>
</ol>
</li>
<li>Run <em>cesm_setup</em>. This will create a separate <em>user_nl_cism_NNNN</em>
file for each ensemble member (where <em>NNNN</em> is the number of the
ensemble member). If you are running with multiple data land ensemble
members, then there will also be separate <em>user_nl_dlnd_NNNN</em> and
<em>user_nl_dsno_NNNN</em> files.</li>
<li>Put any namelist / configuration modifications specific to a single
ensemble member in that member’s <em>user_nl_cism_NNNN</em> file.
Modifications that apply to all ensemble members must be put in ALL
<em>user_nl_cism_NNNN</em> files.</li>
<li>Build and run the model as normal. Output files will be similar to
those in a standard run, except there will now be N instances of each
output file (history, restart and log files), which are
differentiated by an occurrence of <em>_NNNN</em> in the file name.</li>
</ol>
</div>
<div class="section" id="how-do-i-initialize-each-ensemble-member-with-a-different-restart-file">
<h2>6.2. How do I initialize each ensemble member with a different restart file?<a class="headerlink" href="#how-do-i-initialize-each-ensemble-member-with-a-different-restart-file" title="Permalink to this headline">¶</a></h2>
<p>In each <em>user_nl_cism_NNNN</em> file, set the value of the
<em>cisminputfile</em> parameter to point to the desired restart file for that
ensemble member. For example:</p>
<ul class="simple">
<li>echo “cisminputfile = ‘/path/to/file/for/member1.nc’ ” &gt;&gt;
user_nl_cism_0001</li>
<li>echo “cisminputfile = ‘/path/to/file/for/member2.nc’ ” &gt;&gt;
user_nl_cism_0002</li>
</ul>
</div>
<div class="section" id="how-do-i-use-different-forcing-data-for-each-cism-ensemble-member-in-a-tg-compset">
<h2>6.3. How do I use different forcing data for each CISM ensemble member in a TG compset?<a class="headerlink" href="#how-do-i-use-different-forcing-data-for-each-cism-ensemble-member-in-a-tg-compset" title="Permalink to this headline">¶</a></h2>
<p>To run with different forcing data for each CISM ensemble member in a TG
compset, you need to use N dlnd instances, as described above, where
dlnd #1 will force CISM #1, etc. Note that, even if the different CISM
ensemble members are identical in everything except for their forcings,
you still need to use N CISM ensemble members in this case.</p>
<p>After running <em>cesm_setup</em>, you will see multiple instances of each of
the dlnd input files in CaseDocs: <em>dlnd_in_NNNN, dsno_in_NNNN,</em> and
<em>dlnd.streams.txt.sno.cplhist_NNNN.</em></p>
<ul class="simple">
<li>preview_namelists</li>
<li>cp CaseDocs/dlnd.streams.txt.sno.cplhist_NNNN
./user_dlnd.streams.txt.sno.cplhist_NNNN</li>
<li>chmod u+w user_dlnd.streams.txt.sno.cplhist_NNNN</li>
</ul>
<p>Then change each <em>user_dlnd.streams.txt.sno.cplhist_NNNN</em> file as
desired. Usually, you will change the variables listed under <em>filePath</em>
and/or <em>fileNames</em> in the <em>fieldInfo</em> section of this file.</p>
<p><strong>Important note:</strong> Once you have created a
<em>user_dlnd.streams.txt.sno.cplhist</em> file, further changes to most of
the <em>DLND_*</em> variables in <em>env_run.xml</em> will have no effect. Thus, if
you need to change any of these variables, first remove the
<em>user_dlnd.streams.txt.sno.cplhist_NNNN</em> files, then make necessary
modifications to these xml variables. Finally, repeat the above
procedure for modifying the streams files.</p>
</div>
<div class="section" id="how-do-i-force-each-ensemble-member-with-a-different-set-of-years">
<h2>6.4. How do I force each ensemble member with a different set of years?<a class="headerlink" href="#how-do-i-force-each-ensemble-member-with-a-different-set-of-years" title="Permalink to this headline">¶</a></h2>
<p>If you want to use a different set of years for each CISM ensemble
member in a TG compset, you can do this by setting the <em>streams</em>
variable in each of the <em>user_nl_dsno_NNNN</em> files. This technique can
be used separately from or together with the above technique for using a
different set of forcing files for each ensemble member.</p>
<p>For example, if you have forcing data from 1850 –&nbsp;2005, and you want to
force CISM #1 by looping through the years 1850 – 1899, and CISM #2 by
looping through the years 1900 –&nbsp;2005, you would do the following:</p>
<ol class="arabic">
<li><p class="first">Set <em>DLND_CPLHIST_YR_START</em> to 1850 and <em>DLND_CPLHIST_YR_END</em>
to 2005 in <em>env_run.xml</em>. These variables determine the full set of
files available to dlnd, by creating the file names in the
<em>dlnd.streams.txt.sno.cplhist_NNNN</em> files. It is fine for all
available years to be listed in each of these streams files. So if
all you want to do is use a different subset of years for each
ensemble member (drawing from the same full set of files), you will
not need to modify these streams files.</p>
</li>
<li><p class="first">Add the following line to <em>user_nl_dsno_0001</em> (note that the three
values are: <em>yr_align, yr_start, yr_end</em>. This example assumes
that you want to use <em>yr_align</em>=1, which would be appropriate if
<em>RUN_STARTDATE</em> is year 1; otherwise, you likely will want to set
<em>yr_align</em> to match the start year of the run):</p>
<blockquote>
<div><p>streams = “dlnd.streams.txt.sno.cplhist_0001 1 1850 1899”</p>
</div></blockquote>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Add the following line to <em>user_nl_dsno_0002:</em></p>
<blockquote>
<div><p>streams = “dlnd.streams.txt.sno.cplhist_0002 1 1900 2005”</p>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="how-do-i-run-clm-with-something-other-than-10-elevation-classes-and-or-how-do-i-create-a-clm4-5-surface-dataset-that-is-consistent-with-cism-over-greenland">
<h2>6.5. How do I run CLM with something other than 10 elevation classes, and/or how do I create a CLM4.5 surface dataset that is consistent with CISM over Greenland?<a class="headerlink" href="#how-do-i-run-clm-with-something-other-than-10-elevation-classes-and-or-how-do-i-create-a-clm4-5-surface-dataset-that-is-consistent-with-cism-over-greenland" title="Permalink to this headline">¶</a></h2>
<p>These are two separate questions, but both require running CLM’s
<em>mksurfdata_map</em> tool, so they are combined here for convenience.</p>
<p>For compsets that use CLM’s <em>glacier_mec</em> code (IG, FG and BG
compsets), the default is to use 10 elevation classes. As discussed in
Section 5.3, the code currently supports running with 1, 3, 5, 10 or 36
elevation classes. <strong>However, there is currently a bug in CLM that
prevents running the glacier_mec code with 1 elevation class.</strong> (This
bug is in the setting of the elevation of virtual columns in
subgridMod.F90.)</p>
<p>Each number of elevation classes requires a different surface dataset
for CLM. Currently, CLM surface datasets have only been created with 10
elevation classes. Thus, if you want to run with a different number of
elevation classes, you must first create a new surface dataset, along
with a transient pft dataset if you will be doing a transient run. The
process for creating these datasets is described in the CLM User’s
Guide. Briefly, you will use CLM’s <em>mksurfdata_map</em> tool, contained in
<em>models/lnd/clm/tools/clmXXX/mksurfdata_map</em>, where XXX is either 4_0
or 4_5, depending on whether you are creating a surface dataset for
CLM4.0 or CLM4.5. It is easiest to use the <em>mksurfdata.pl</em> wrapper
script contained in that directory, providing the argument <em>-glc_nec.</em>
For example, to create a surface dataset with 36 elevation classes at
0.9x1.25 degree resolution, for the year 1850, along with a transient
pft dataset spanning the late 19<sup>th</sup> and 20<sup>th</sup> centuries,
you would run:</p>
<ul class="simple">
<li>mksurfdata.pl -res 0.9x1.25 -y 1850-2000 -glc_nec 36</li>
</ul>
<p>There is an important difference in behavior between the CLM4.0 vs.
CLM4.5 versions of this tool: In the CLM4.0 version, specifying any
non-zero value for -glc_nec gives you a version of the percent glacier
raw dataset that is consistent with the CISM dataset over Greenland.
However, in the CLM4.5 version, regardless of the value of -glc_nec,
the default glacier raw dataset comes entirely from the Randolph Glacier
Inventory. <strong>For CLM4.5, if you want to create a surface dataset that is
consistent with CISM over Greenland, you will need to add the
*-merge_gis* argument to mksurfdata.pl.</strong></p>
<p>You can then create a case using an IG, FG or BG compset. Before
running, you will need to change three settings:</p>
<ul class="simple">
<li><em>GLC_NEC</em> in <em>env_run.xml</em> (e.g., <em>xmlchange GLC_NEC=36</em>).</li>
<li>Point CLM to the new surface dataset you created (specify <em>fsurdat</em>
in <em>user_nl_clm</em>).</li>
<li>If relevant to your case, point CLM to the new transient pft dataset
you created (specify <em>fpftdyn</em> in <em>user_nl_clm</em>).</li>
</ul>
</div>
<div class="section" id="how-do-i-add-new-settings-in-cism-s-namelist-or-config-file">
<h2>6.6. How do I add new settings in CISM’s namelist or config file?<a class="headerlink" href="#how-do-i-add-new-settings-in-cism-s-namelist-or-config-file" title="Permalink to this headline">¶</a></h2>
<p>If your code development requires the addition of a runtime setting, set
either in <em>cism_in</em> or <em>cism.config</em>, you will need to add information
about the new variable in the xml file that is used to generate these
input files. See the documentation in
<em>models/glc/cism/bld/README.build-namelist</em>, and particularly the
section “CISM Use Cases”.</p>
</div>
<div class="section" id="how-do-i-output-forcing-fields-sent-from-clm-to-cism">
<h2>6.7. How do I output forcing fields sent from CLM to CISM?<a class="headerlink" href="#how-do-i-output-forcing-fields-sent-from-clm-to-cism" title="Permalink to this headline">¶</a></h2>
<p>CLM sends three sets of fields to CISM, for each elevation class: <em>qice,
tsrf</em> and <em>topo</em> (see Section 5.2). It can often be useful to view the
values of these forcing fields for each elevation class within each grid
cell. To do this, you can use the three CLM history variables,
<em>QICE_FORC, TSRF_FORC</em> and <em>TOPO_FORC.</em> These history variables are
inactive by default, but can be added to any of CLM’s history files
using the <em>hist_fincl</em> CLM namelist variables. For example, to add
<em>QICE_FORC</em> and <em>TSRF_FORC</em> to CLM’s default (monthly) history file,
you would add the following in <em>user_nl_clm</em>:</p>
<p>hist_fincl1 = ‘QICE_FORC’,’TSRF_FORC’</p>
<p>As with other CLM history variables, additional history files can be
created with different time frequencies. See the CLM User’s Guide for
details on how to do this.</p>
</div>
<div class="section" id="how-do-i-add-a-clm-history-field-that-provides-averages-only-over-ice">
<h2>6.8. How do I add a CLM history field that provides averages only over ice?<a class="headerlink" href="#how-do-i-add-a-clm-history-field-that-provides-averages-only-over-ice" title="Permalink to this headline">¶</a></h2>
<p>In general, CLM history fields give weighted averages over the entire
grid cell. If you are interested in diagnostics just over ice landunits
for certain history fields, you can make a source code modification for
each field of interest. This is done in
<em>models/lnd/clm/src/main/histFldsMod.F90</em>: Find the history field(s) of
interest in this file, and add the following optional argument to the
<em>hist_addfld1d</em> or <em>hist_addfld2d</em> call for that history field:
<em>l2g_scale_type=’ice’</em>. You may want to copy and paste the call in
order to maintain the original history field and add a new field that
applies just over ice (being sure to change <em>fname</em>). For example,
examine the difference between the fields <em>TSOI</em> and <em>TSOI_ICE</em>:</p>
<p>call hist_addfld2d (fname=’TSOI’, units=’K’, type2d=’levgrnd’, &amp;</p>
<p>avgflag=’A’, long_name=’soil temperature (vegetated landunits only)’, &amp;</p>
<p>ptr_col=clm3%g%l%c%ces%t_soisno, l2g_scale_type=’veg’)</p>
<p>call hist_addfld2d (fname=’TSOI_ICE’, units=’K’, type2d=’levgrnd’, &amp;</p>
<p>avgflag=’A’, long_name=’soil temperature (ice landunits only)’, &amp;</p>
<p>ptr_col=clm3%g%l%c%ces%t_soisno, l2g_scale_type=’ice’)</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="acknowledgements.html" title="7. Acknowledgments"
             >next</a> |</li>
        <li class="right" >
          <a href="ice-sheets-in-clm.html" title="5. Ice sheets in the Community Land Model"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">cismdoc  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >CISM User’s Guide</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, William Lipsco.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.
    </div>
  </body>
</html>