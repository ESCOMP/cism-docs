

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>5. Controlling output from CISM and CLM &#8212; CESM Land Ice CESM2.0 documentation</title>
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6. Coupling CLM and CISM" href="clm-cism-coupling.html" />
    <link rel="prev" title="4. The dynamic ice sheet model" href="dynamic-ice-sheet-model.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="clm-cism-coupling.html" title="6. Coupling CLM and CISM"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="dynamic-ice-sheet-model.html" title="4. The dynamic ice sheet model"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CESM Land Ice CESM2.0 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">5. Controlling output from CISM and CLM</a><ul>
<li><a class="reference internal" href="#controlling-cism-output">5.1. Controlling CISM output</a></li>
<li><a class="reference internal" href="#producing-land-ice-specific-output-from-clm">5.2. Producing land ice-specific output from CLM</a><ul>
<li><a class="reference internal" href="#outputting-forcing-fields-sent-from-clm-to-cism">5.2.1. Outputting forcing fields sent from CLM to CISM</a></li>
<li><a class="reference internal" href="#adding-a-clm-history-field-that-provides-averages-only-over-ice">5.2.2. Adding a CLM history field that provides averages only over ice</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="dynamic-ice-sheet-model.html"
                        title="previous chapter">4. The dynamic ice sheet model</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="clm-cism-coupling.html"
                        title="next chapter">6. Coupling CLM and CISM</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/controlling-output.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="controlling-output-from-cism-and-clm">
<span id="controlling-output"></span><h1>5. Controlling output from CISM and CLM<a class="headerlink" href="#controlling-output-from-cism-and-clm" title="Permalink to this headline">¶</a></h1>
<div class="section" id="controlling-cism-output">
<h2>5.1. Controlling CISM output<a class="headerlink" href="#controlling-cism-output" title="Permalink to this headline">¶</a></h2>
<p>The default CISM output frequency is yearly. Most of the CISM output fields are
instantaneous, so this default frequency means that you get a snapshot of the current
state at the end of each year. You can change the output to be less frequent via the
namelist variable <code class="docutils literal notranslate"><span class="pre">history_frequency</span></code>, which can be set in <code class="docutils literal notranslate"><span class="pre">user_nl_cism</span></code>. For
example, to give output every 10 years, set:</p>
<div class="highlight-Fortran notranslate"><div class="highlight"><pre><span></span><span class="n">history_frequency</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
<p>The set of variables written to each history file is controlled by the namelist variable
<code class="docutils literal notranslate"><span class="pre">cesm_history_vars</span></code>. To see the variables output by default, examine
<code class="docutils literal notranslate"><span class="pre">CaseDocs/cism_in</span></code> after running <code class="docutils literal notranslate"><span class="pre">preview_namelists</span></code> for your case. Among the standard
fields written to the history file are the ice thickness (<code class="docutils literal notranslate"><span class="pre">thk</span></code>), upper surface
elevation (<code class="docutils literal notranslate"><span class="pre">usurf</span></code>), bedrock elevation (<code class="docutils literal notranslate"><span class="pre">topg</span></code>), and the surface mass balance
(<code class="docutils literal notranslate"><span class="pre">smb</span></code>) and surface temperature (<code class="docutils literal notranslate"><span class="pre">artm</span></code>) downscaled to the ice sheet grid.</p>
<p>To modify the list of history fields, set <code class="docutils literal notranslate"><span class="pre">cesm_history_vars</span></code> in <code class="docutils literal notranslate"><span class="pre">user_nl_cism</span></code>. Files
with names ending in <code class="docutils literal notranslate"><span class="pre">vars.def</span></code> in the source tree specify the fields that can be
written out. You can add new variables to one of these <code class="docutils literal notranslate"><span class="pre">vars.def</span></code> files and rebuild the
model in order to enable new output fields. (Note: These <code class="docutils literal notranslate"><span class="pre">vars.def</span></code> files can NOT be
placed in SourceMods: they need to be changed in-place in the source tree.)</p>
<p>Model restart frequency is coordinated by the CESM coupler. The restart file contains all
the fields required for exact restart.  However, the restart will be exact only if the
file is written immediately after an ice dynamics time step. This will normally be the
case for restart files written at the end of any model year.</p>
</div>
<div class="section" id="producing-land-ice-specific-output-from-clm">
<h2>5.2. Producing land ice-specific output from CLM<a class="headerlink" href="#producing-land-ice-specific-output-from-clm" title="Permalink to this headline">¶</a></h2>
<div class="section" id="outputting-forcing-fields-sent-from-clm-to-cism">
<h3>5.2.1. Outputting forcing fields sent from CLM to CISM<a class="headerlink" href="#outputting-forcing-fields-sent-from-clm-to-cism" title="Permalink to this headline">¶</a></h3>
<p>CLM sends two sets of fields to CISM for each elevation class: <code class="docutils literal notranslate"><span class="pre">qice</span></code> and <code class="docutils literal notranslate"><span class="pre">tsrf</span></code>. In
addition, it sends a third set of fields to the coupler for downscaling purposes:
<code class="docutils literal notranslate"><span class="pre">topo</span></code>. It can often be useful to view the values of these forcing fields for each
elevation class within each grid cell. To do this, you can use the three CLM history
variables, <code class="docutils literal notranslate"><span class="pre">QICE_FORC</span></code>, <code class="docutils literal notranslate"><span class="pre">TSRF_FORC</span></code> and <code class="docutils literal notranslate"><span class="pre">TOPO_FORC</span></code>. These history variables are
inactive by default, but can be added to any of CLM’s history files using the
<code class="docutils literal notranslate"><span class="pre">hist_fincl</span></code> CLM namelist variables. For example, to add <code class="docutils literal notranslate"><span class="pre">QICE_FORC</span></code> and <code class="docutils literal notranslate"><span class="pre">TSRF_FORC</span></code>
to CLM’s default (monthly) history file, you would add the following in <code class="docutils literal notranslate"><span class="pre">user_nl_clm</span></code>:</p>
<div class="highlight-Fortran notranslate"><div class="highlight"><pre><span></span><span class="n">hist_fincl1</span> <span class="o">=</span> <span class="s1">&#39;QICE_FORC&#39;</span><span class="p">,</span><span class="s1">&#39;TSRF_FORC&#39;</span>
</pre></div>
</div>
<p>As with other CLM history variables, additional history files can be created with
different time frequencies. See the <a class="reference external" href="https://escomp.github.io/ctsm-docs">CLM User’s Guide</a> for details on how to do this.</p>
</div>
<div class="section" id="adding-a-clm-history-field-that-provides-averages-only-over-ice">
<h3>5.2.2. Adding a CLM history field that provides averages only over ice<a class="headerlink" href="#adding-a-clm-history-field-that-provides-averages-only-over-ice" title="Permalink to this headline">¶</a></h3>
<p>In general, CLM history fields give weighted averages over the entire grid cell. If you
are interested in diagnostics just over ice landunits for certain history fields, you can
make a source code modification for each field of interest.</p>
<p>CLM history field definitions are distributed throughout the CLM source code. The first
step is to find the <code class="docutils literal notranslate"><span class="pre">hist_addfld1d</span></code> or <code class="docutils literal notranslate"><span class="pre">hist_addfld2d</span></code> subroutine call for the history
field(s) of interest, by searching the code for the history field name. Then add a new
<code class="docutils literal notranslate"><span class="pre">hist_addfld1d</span></code> or <code class="docutils literal notranslate"><span class="pre">hist_addfld2d</span></code> call that is mostly the same as the original, but:</p>
<ol class="arabic simple">
<li>Change the field name (<code class="docutils literal notranslate"><span class="pre">fname</span></code>), for example, changing <code class="docutils literal notranslate"><span class="pre">TSOI</span></code> to <code class="docutils literal notranslate"><span class="pre">TSOI_ICE</span></code></li>
<li>Change <code class="docutils literal notranslate"><span class="pre">long_name</span></code> to call out that this field just applies over ice landunits</li>
<li>Add a new argument to the call: <code class="docutils literal notranslate"><span class="pre">l2g_scale_type='ice'</span></code>.</li>
<li>Possibly add <code class="docutils literal notranslate"><span class="pre">default='inactive'</span></code> so that this field only appears if explicitly
requested in <code class="docutils literal notranslate"><span class="pre">user_nl_clm</span></code>.</li>
</ol>
<p>Here are some examples of currently-defined <code class="docutils literal notranslate"><span class="pre">_ICE</span></code> fields and their non-<code class="docutils literal notranslate"><span class="pre">_ICE</span></code>
counterparts:</p>
<div class="highlight-Fortran notranslate"><div class="highlight"><pre><span></span><span class="k">call </span><span class="n">hist_addfld2d</span> <span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;TSOI&#39;</span><span class="p">,</span>  <span class="n">units</span><span class="o">=</span><span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="n">type2d</span><span class="o">=</span><span class="s1">&#39;levgrnd&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
     <span class="n">avgflag</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="s1">&#39;soil temperature (vegetated landunits only)&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
     <span class="n">ptr_col</span><span class="o">=</span><span class="n">this</span><span class="p">%</span><span class="n">t_soisno_col</span><span class="p">,</span> <span class="n">l2g_scale_type</span><span class="o">=</span><span class="s1">&#39;veg&#39;</span><span class="p">)</span>

<span class="k">call </span><span class="n">hist_addfld2d</span> <span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;TSOI_ICE&#39;</span><span class="p">,</span>  <span class="n">units</span><span class="o">=</span><span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="n">type2d</span><span class="o">=</span><span class="s1">&#39;levgrnd&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
     <span class="n">avgflag</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="s1">&#39;soil temperature (ice landunits only)&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
     <span class="n">ptr_col</span><span class="o">=</span><span class="n">this</span><span class="p">%</span><span class="n">t_soisno_col</span><span class="p">,</span> <span class="n">l2g_scale_type</span><span class="o">=</span><span class="s1">&#39;ice&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-Fortran notranslate"><div class="highlight"><pre><span></span><span class="k">call </span><span class="n">hist_addfld1d</span> <span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;FSH&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;W/m^2&#39;</span><span class="p">,</span>  <span class="p">&amp;</span>
     <span class="n">avgflag</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="s1">&#39;sensible heat not including correction for land use change and rain/snow conversion&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
     <span class="n">ptr_patch</span><span class="o">=</span><span class="n">this</span><span class="p">%</span><span class="n">eflx_sh_tot_patch</span><span class="p">,</span> <span class="n">c2l_scale_type</span><span class="o">=</span><span class="s1">&#39;urbanf&#39;</span><span class="p">)</span>

<span class="k">call </span><span class="n">hist_addfld1d</span> <span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="s1">&#39;FSH_ICE&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;W/m^2&#39;</span><span class="p">,</span>  <span class="p">&amp;</span>
     <span class="n">avgflag</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
     <span class="n">long_name</span><span class="o">=</span><span class="s1">&#39;sensible heat not including correction for land use change and rain/snow conversion (ice landunits only)&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
     <span class="n">ptr_patch</span><span class="o">=</span><span class="n">this</span><span class="p">%</span><span class="n">eflx_sh_tot_patch</span><span class="p">,</span> <span class="n">c2l_scale_type</span><span class="o">=</span><span class="s1">&#39;urbanf&#39;</span><span class="p">,</span> <span class="n">l2g_scale_type</span><span class="o">=</span><span class="s1">&#39;ice&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
     <span class="n">default</span><span class="o">=</span><span class="s1">&#39;inactive&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that there are already many <code class="docutils literal notranslate"><span class="pre">_ICE</span></code> fields defined in the code, but many of these
are inactive by default (meaning that they need to be explicitly added to history field
lists via CLM’s <code class="docutils literal notranslate"><span class="pre">hist_fincl</span></code> mechanism).</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="clm-cism-coupling.html" title="6. Coupling CLM and CISM"
             >next</a> |</li>
        <li class="right" >
          <a href="dynamic-ice-sheet-model.html" title="4. The dynamic ice sheet model"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">CESM Land Ice CESM2.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Gunter Leguy, William Lipscomb, Bill Sacks.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.
    </div>
  </body>
</html>