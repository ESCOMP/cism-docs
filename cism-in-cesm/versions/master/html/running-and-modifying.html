

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2. Running and modifying the CESM land ice component &mdash; CESM Land Ice master documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="CESM Land Ice master documentation" href="index.html"/>
        <link rel="next" title="3. Running the fully-coupled ice sheet model within CESM: B compsets" href="b-compsets.html"/>
        <link rel="prev" title="1. Introduction" href="introduction.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> CESM Land Ice
          

          
          </a>

          
            
            
              <div class="version">
                
                  <div class="version-dropdown">
                    <select class="version-list" id="version-list">
                      <option value=''>master</option>
                      
                        
                      
                        
                          <option value="">[placeholder]</option>
                        
                      
                    </select>
                  </div>
                
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Running and modifying the CESM land ice component</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#choosing-a-cesm-configuration-for-land-ice-work">2.1. Choosing a CESM configuration for land ice work</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#choosing-a-compset">2.1.1. Choosing a compset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#choosing-a-cism-grid">2.1.2. Choosing a CISM grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="#special-considerations-for-hybrid-cases">2.1.3. Special considerations for hybrid cases</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#modifying-namelist-settings">2.2. Modifying namelist settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modifying-source-code">2.3. Modifying source code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#source-code-directory-structure-and-repositories">2.3.1. Source code directory structure and repositories</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#changing-code-in-place-in-the-source-tree">2.3.1.1. Changing code in-place in the source tree</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-sourcemods">2.3.1.2. Using SourceMods</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="b-compsets.html">3. Running the fully-coupled ice sheet model within CESM: B compsets</a></li>
<li class="toctree-l1"><a class="reference internal" href="t-compsets.html">4. Running the standalone ice sheet model within CESM: T compsets</a></li>
<li class="toctree-l1"><a class="reference internal" href="controlling-output.html">5. Controlling output from CISM and CLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="clm-cism-coupling.html">6. Coupling CLM and CISM</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">7. Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">8. References</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="new-grids.html"><span class="sectnum">A.1</span> Introducing a new ice sheet grid</a></li>
<li class="toctree-l1"><a class="reference internal" href="new-icesheet.html"><span class="sectnum">A.2</span> Introducing a new ice sheet</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CESM Land Ice</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li><span class="section-number">2. </span>Running and modifying the CESM land ice component</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/running-and-modifying.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <span class="target" id="running-and-modifying"></span><div class="section" id="running-and-modifying-the-cesm-land-ice-component">
<h1><span class="section-number">2. </span>Running and modifying the CESM land ice component<a class="headerlink" href="#running-and-modifying-the-cesm-land-ice-component" title="Permalink to this headline">¶</a></h1>
<p>This section provides an overview of some of the most important information needed when
running a land ice-focused CESM case. This assumes you are familiar with the basic process
of obtaining and running CESM, as described in the <a class="reference external" href="https://escomp.github.io/cesm">CESM Quickstart guide</a> and the <a class="reference external" href="http://esmci.github.io/cime/users_guide/">CIME documentation</a>.</p>
<p>In CESM, land ice processes are simulated by two components: The land ice (glc) component
and the land (lnd) component. The land ice component is CISM, the Community Ice Sheet
Model; the land component is CLM, the Community Land Model (which is now part of CTSM, the
Community Terrestrial Systems Model). CLM is responsible for computing the surface mass
balance and surface temperature of ice sheets, along with snow pack evolution for all land
cover types. CISM is responsible for ice sheet dynamics and other ice sheet internal
processes. CISM can include one or more independent ice sheets within a given simulation, each with their own grid.</p>
<div class="section" id="choosing-a-cesm-configuration-for-land-ice-work">
<h2><span class="section-number">2.1. </span>Choosing a CESM configuration for land ice work<a class="headerlink" href="#choosing-a-cesm-configuration-for-land-ice-work" title="Permalink to this headline">¶</a></h2>
<div class="section" id="choosing-a-compset">
<h3><span class="section-number">2.1.1. </span>Choosing a compset<a class="headerlink" href="#choosing-a-compset" title="Permalink to this headline">¶</a></h3>
<p>CESM high-level configurations are known as “compsets” (short for “component sets”,
described in more detail in the <a class="reference external" href="http://esmci.github.io/cime/users_guide/compsets.html">CIME documentation</a>, the <a class="reference external" href="https://escomp.github.io/cesm/release-cesm2/cesm_configurations.html">CESM documentation</a>, and the <a class="reference external" href="http://www.cesm.ucar.edu/models/cesm2.0/cesm/compsets.html">table
of available compsets</a>). At
the compset level, there are three main modes for configuring CESM’s ice sheet component:</p>
<ol class="arabic">
<li><p>Using CISM with ice evolution turned on.</p>
<p>These compsets have <code class="docutils literal notranslate"><span class="pre">CISM2%AIS-EVOLVE</span></code> and/or <code class="docutils literal notranslate"><span class="pre">CISM2%GRIS-EVOLVE</span></code> in their compset long name. They typically have the
letter <code class="docutils literal notranslate"><span class="pre">G</span></code> somewhere near the end of their alias, with <code class="docutils literal notranslate"><span class="pre">Ga</span></code> for a compset with Antarctica, <code class="docutils literal notranslate"><span class="pre">Gg</span></code> for a compset with Greenland, and <code class="docutils literal notranslate"><span class="pre">Gag</span></code> for a compset with both Antarctica and Greenland. CISM is fully active, receiving SMB
from CLM and evolving dynamically. In addition, by default, CISM feeds information back
to other climate system components — i.e., it is two-way coupled. Specifically, it
sends:</p>
<ul class="simple">
<li><p>Glacier areas and elevations to CLM</p></li>
<li><p>Ice and liquid runoff to the ocean</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Part or all of this two-way coupling can be turned off if desired.
Note that the liquid runoff sent to the ocean consists of meltwater computed in the interior
or at the base of the ice; surface liquid runoff is handled separately by CLM.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</li>
<li><p>Using CISM with one or more ice sheets, with ice evolution turned off.</p>
<p>These compsets have <code class="docutils literal notranslate"><span class="pre">CISM2%AIS-NOEVOLVE</span></code> and/or <code class="docutils literal notranslate"><span class="pre">CISM2%GRIS-NOEVOLVE</span></code> in their compset long name. CISM is built into the system but it does very little. CISM serves two roles in the system in this configuration:</p>
<ul class="simple">
<li><p>Over the CISM domain(s) (typically Greenland and/or Antarctica), CISM dictates glacier areas and
topographic elevations, overriding the values on CLM’s surface dataset. CISM also
dictates the elevation of non-glacier land units in its domain, and only in this
domain does CLM downscale atmospheric fields to non-glacier land units.</p></li>
<li><p>CISM provides the grid onto which SMB is downscaled.</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>It is also possible for a compset to have one or more ice sheets evolving and one or more ice sheets non-evolving.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</li>
<li><p>Using a stub glacier component (SGLC), completely avoiding the use of CISM.</p>
<p>These configurations have <code class="docutils literal notranslate"><span class="pre">SGLC</span></code> in the compset long name. This is similar to (2), and CLM still computes
ice sheet surface mass balance. However:</p>
<ul class="simple">
<li><p>Glacier areas and elevations are taken entirely from CLM’s surface dataset, and CLM
does not perform any downscaling to non-glacier land units.</p></li>
<li><p>Although SMB is still computed in CLM, it won’t be downscaled to a high-resolution
ice sheet grid.</p></li>
</ul>
<p>There are a few possible reasons why you may want to run in this configuration:</p>
<ul class="simple">
<li><p>Single-point and regional runs over glacier regions, where it doesn’t make sense to
run a dynamic ice sheet model.</p></li>
<li><p>Runs with a Gregorian calendar (i.e., with leap years): CISM does not currently
support a Gregorian calendar, so these runs need to use SGLC. This includes data
assimilation and CAM specified dynamics runs.</p></li>
<li><p>Other cases where you don’t want to include CISM because of the extra complexity this
involves, such as when setting up a new grid (which would require additional mapping
files for CISM).</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</li>
</ol>
<p>A case can include any number of ice sheets. The ice sheet(s) included in the case should be chosen at <code class="docutils literal notranslate"><span class="pre">create_newcase</span></code> time, via choice of an appropriate compset. For example, a compset with both Antarctica and Greenland evolving will have <code class="docutils literal notranslate"><span class="pre">CISM2%AIS-EVOLVE%GRIS-EVOLVE</span></code> in the compset long name, and will typically have <code class="docutils literal notranslate"><span class="pre">Gag</span></code> in the compset alias.</p>
<p>The choice of evolution or non-evolution for each ice sheet can be chosen via the compset, but this can also be safely changed after creating a case by setting the xml variables, <code class="docutils literal notranslate"><span class="pre">CISM_EVOLVE_ANTARCTICA</span></code>, <code class="docutils literal notranslate"><span class="pre">CISM_EVOLVE_GREENLAND</span></code>, etc. You also need to set the overall <code class="docutils literal notranslate"><span class="pre">CISM_EVOLVE</span></code> to be consistent with the ice sheet-specific variables: <code class="docutils literal notranslate"><span class="pre">CISM_EVOLVE</span></code> must be set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> if <em>any</em> ice sheet is set to evolve, and must be set to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> if no ice sheet is set to evolve. (The scripts will check this for you and won’t let you run your case if you have failed to set these variables consistently.)</p>
</div>
<div class="section" id="choosing-a-cism-grid">
<span id="id1"></span><h3><span class="section-number">2.1.2. </span>Choosing a CISM grid<a class="headerlink" href="#choosing-a-cism-grid" title="Permalink to this headline">¶</a></h3>
<p>The CESM components can be run on a variety of grids, listed in <a class="reference external" href="http://www.cesm.ucar.edu/models/cesm2.0/cesm/grids.html">this table</a>. The atmosphere and land are
often run on the same grid, but CESM supports running them on different grids. The ocean
and sea ice components must always run on the same grid. The ice-sheet component has a
grid for each active ice sheet.  Unlike the other component grids, which are global, the
ice-sheet grids have limited domains. The current grids are polar stereographic
projections with rectangular grid cells.</p>
<p>Currently, CESM only supports running CISM over Greenland. The standard grid has a
resolution of 4 km; a 20 km grid is also supported for software testing purposes. There is
out-of-the-box support for running the 4 km grid with most or all of the commonly-used
atmosphere/land and ocean grids.</p>
<p>The alias for a typical CESM grid lists the atmosphere/land grid followed by the ocean
grid. For example, <code class="docutils literal notranslate"><span class="pre">f09_g17</span></code> runs the atmosphere and land on a 0.9°x1.25°
finite-volume grid and the ocean and sea ice on a displaced Greenland pole 1°
grid. If you don’t specify the CISM grid explicitly in the grid alias, it will use the
default grid (4 km). For some common grids, you can also specify the grid explicitly in
the alias, using a <code class="docutils literal notranslate"><span class="pre">_gris</span></code> element following the ocean grid. For example, for a compset
with CISM2, <code class="docutils literal notranslate"><span class="pre">f09_g17_gris4</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">f09_g17</span></code>.</p>
<p>For the <code class="docutils literal notranslate"><span class="pre">T1850Gg</span></code> compset (described in <a class="reference internal" href="t-compsets.html#t-compsets"><span class="std std-numref">Section 4</span></a>), you should use grid
<code class="docutils literal notranslate"><span class="pre">f09_g17_gris4</span></code>. For <code class="docutils literal notranslate"><span class="pre">T1850Ga</span></code>, you should use grid <code class="docutils literal notranslate"><span class="pre">f09_g17_ais8</span></code>. For information on introducing new ice sheet grids, see <a class="reference internal" href="new-grids.html#new-grids"><span class="std std-ref">A.1   Introducing a new ice sheet grid</span></a>.</p>
<p>If multiple ice sheets are included in the compset, then you must choose a CESM grid that specifies an ice sheet grid for each active ice sheet (regardless of whether each ice sheet is evolving or non-evolving). For example, for the <code class="docutils literal notranslate"><span class="pre">T1850Gag</span></code> compset (which includes both Antarctica and Greenland), you can use grid <code class="docutils literal notranslate"><span class="pre">f09_g17_ais8gris4</span></code>, denoting an 8-km Antarctica grid and a 4-km Greenland grid.</p>
</div>
<div class="section" id="special-considerations-for-hybrid-cases">
<h3><span class="section-number">2.1.3. </span>Special considerations for hybrid cases<a class="headerlink" href="#special-considerations-for-hybrid-cases" title="Permalink to this headline">¶</a></h3>
<p>As described in the <a class="reference external" href="http://esmci.github.io/cime/users_guide/running-a-case.html#run-type-initialization">CIME documentation</a>,
hybrid cases are commonly used to start a case from a pre-existing case. Generally, all
components start up from the restart files in the reference case. However, in some
situations, you may want to run a case that is a hybrid start for most components — so
that they start from spun-up initial conditions — but for which CISM starts with
observed initial conditions instead of a restart file. For example, you may not have a
CISM restart file for this case, or the scientific purpose of the run might warrant
starting with observed initial conditions rather than an existing restart file.</p>
<p>To do this, set the <code class="docutils literal notranslate"><span class="pre">CISM_OBSERVED_IC</span></code> variable in <code class="docutils literal notranslate"><span class="pre">env_run.xml</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./xmlchange CISM_OBSERVED_IC=TRUE</span>
</pre></div>
</div>
<p>This will force CISM to start from the same observed initial conditions that are used for
a startup run.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">CISM_OBSERVED_IC</span></code> is ignored for startup runs; for branch runs, it must be
FALSE.</p>
<p>If you are doing a hybrid run where you have changed <code class="docutils literal notranslate"><span class="pre">cisminputfile</span></code> to point to a
restart file from a standalone CISM case (i.e., a run done outside of CESM) or a case with
different physics options, then you must also set <code class="docutils literal notranslate"><span class="pre">restart</span> <span class="pre">=</span> <span class="pre">0</span></code> in
<code class="docutils literal notranslate"><span class="pre">user_nl_cism</span></code>. (Otherwise <code class="docutils literal notranslate"><span class="pre">restart</span></code> has a default value of 1 for a hybrid case, which
can give incorrect behavior if you are using a restart file from a case with different
physics options.)</p>
</div>
</div>
<div class="section" id="modifying-namelist-settings">
<h2><span class="section-number">2.2. </span>Modifying namelist settings<a class="headerlink" href="#modifying-namelist-settings" title="Permalink to this headline">¶</a></h2>
<p>Once the code is running, you may want to change namelist or configuration
variables. Variables related to land ice are set in the files <code class="docutils literal notranslate"><span class="pre">cism_in</span></code>, <code class="docutils literal notranslate"><span class="pre">cism.ICESHEET.config</span></code> (for each ice sheet — e.g., <code class="docutils literal notranslate"><span class="pre">cism.ais.config</span></code>, <code class="docutils literal notranslate"><span class="pre">cism.gris.config</span></code>)
and <code class="docutils literal notranslate"><span class="pre">lnd_in</span></code>. These files appear in the run directory, and also in the <code class="docutils literal notranslate"><span class="pre">CaseDocs</span></code>
subdirectory of the case directory. User modifications can be made to these files by
adding lines to <code class="docutils literal notranslate"><span class="pre">user_nl_cism</span></code>, <code class="docutils literal notranslate"><span class="pre">user_nl_cism_ICESHEET</span></code> (for each ice sheet — e.g., <code class="docutils literal notranslate"><span class="pre">user_nl_cism_ais</span></code>, <code class="docutils literal notranslate"><span class="pre">user_nl_cism_gris</span></code>) or
<code class="docutils literal notranslate"><span class="pre">user_nl_clm</span></code>; this is described in more detail below. The
various <code class="docutils literal notranslate"><span class="pre">user_nl_xxx</span></code> files are created when you first run <code class="docutils literal notranslate"><span class="pre">case.setup</span></code> for your
case. They can be modified any time between running <code class="docutils literal notranslate"><span class="pre">case.setup</span></code> and the start of the
run: the model does NOT need to be rebuilt after making namelist changes in these files.</p>
<p>Most parameters directly relevant to ice sheet modeling are set in <code class="docutils literal notranslate"><span class="pre">cism.ICESHEET.config</span></code> for each ice sheet. This
config file contains settings used by CISM — for example, grid information (which is set
automatically based on the resolution set at <code class="docutils literal notranslate"><span class="pre">create_newcase</span></code> time) and physics
parameter settings. The <code class="docutils literal notranslate"><span class="pre">cism_in</span></code> file contains some additional parameters controlling
the CISM run. All of the available settings are given in <a class="reference external" href="http://www.cesm.ucar.edu/models/cesm2.0/component_settings/cism_nml.html">this table</a> (variables in
namelist groups with <code class="docutils literal notranslate"><span class="pre">config</span></code> in their name will go into the <code class="docutils literal notranslate"><span class="pre">cism.ICESHEET.config</span></code> files;
others will go into the <code class="docutils literal notranslate"><span class="pre">cism_in</span></code> file).</p>
<p>The file <code class="docutils literal notranslate"><span class="pre">lnd_in</span></code> provides settings for CLM. CLM’s available settings are given in <a class="reference external" href="https://www.cesm.ucar.edu/models/cesm2/settings/current/clm5_0_nml.html">this
table</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">user_nl_cism</span></code> is used for two purposes: (1) settings that appear in <code class="docutils literal notranslate"><span class="pre">cism_in</span></code>, which apply to all ice sheets; and (2) settings that appear in the ice sheet-specific <code class="docutils literal notranslate"><span class="pre">cism.ICESHEET.config</span></code> files, for which you want to make the same change for all ice sheets. Changes to either of those types of settings can be made by adding lines with the
following format to the <code class="docutils literal notranslate"><span class="pre">user_nl_cism</span></code> file in your case directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">namelist_variable = value</span>
</pre></div>
</div>
<p>Note that there is no distinction in <code class="docutils literal notranslate"><span class="pre">user_nl_cism</span></code> between variables that will appear
in <code class="docutils literal notranslate"><span class="pre">cism_in</span></code> vs. those that will appear in the <code class="docutils literal notranslate"><span class="pre">cism.ICESHEET.config</span></code> files: CISM’s build-namelist
utility knows where each variable belongs. For example, to set the value of <code class="docutils literal notranslate"><span class="pre">cism_debug</span></code>
to <code class="docutils literal notranslate"><span class="pre">.true.</span></code> and <code class="docutils literal notranslate"><span class="pre">dt</span></code> to <code class="docutils literal notranslate"><span class="pre">0.05</span></code> for all ice sheets, include the following in <code class="docutils literal notranslate"><span class="pre">user_nl_cism</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cism_debug = .true.</span>
<span class="go">dt = 0.05</span>
</pre></div>
</div>
<p>After running <code class="docutils literal notranslate"><span class="pre">preview_namelists</span></code>, the following will appear in <code class="docutils literal notranslate"><span class="pre">cism_in</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&amp;cism_params</span>
<span class="go">...</span>
<span class="go">cism_debug = .true.</span>
<span class="go">...</span>
<span class="go">/</span>
</pre></div>
</div>
<p>and the following will appear in <code class="docutils literal notranslate"><span class="pre">cism.ICESHEET.config</span></code> for all ice sheets:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[time]</span>
<span class="go">...</span>
<span class="go">dt = 0.05</span>
<span class="go">...</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">user_nl_cism_ICESHEET</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">user_nl_cism_ais</span></code>, <code class="docutils literal notranslate"><span class="pre">user_nl_cism_gris</span></code>) is used for settings that appear in the ice sheet-specific <code class="docutils literal notranslate"><span class="pre">cism.ICESHEET.config</span></code> files, for which you want to make a change for just one ice sheet. The syntax for making changes is the same as for <code class="docutils literal notranslate"><span class="pre">user_nl_cism</span></code>, but now this will only impact the single corresponding <code class="docutils literal notranslate"><span class="pre">cism.ICESHEET.config</span></code> file.</p>
<p>Changes to <code class="docutils literal notranslate"><span class="pre">lnd_in</span></code> can be made by adding similar lines to <code class="docutils literal notranslate"><span class="pre">user_nl_clm</span></code>.  For
example, to change the ice albedo (values give albedo in the visible and near-infrared),
add the following line to <code class="docutils literal notranslate"><span class="pre">user_nl_clm</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">albice = 0.55,0.45</span>
</pre></div>
</div>
<p>After changing any of the <code class="docutils literal notranslate"><span class="pre">user_nl_xxx</span></code> files, you can preview the generated namelists
by running the <code class="docutils literal notranslate"><span class="pre">preview_namelists</span></code> utility in the case directory. Generated namelists
will then appear in the CaseDocs subdirectory of your case as well as in the run
directory.</p>
<p>Note: There appears to be a bug in the parsing of strings in <code class="docutils literal notranslate"><span class="pre">user_nl_cism</span></code> that are
bound for <code class="docutils literal notranslate"><span class="pre">cism.ICESHEET.config</span></code>: These appear to be handled correctly if they are single-quoted,
but double-quoted strings lead to buggy behavior.</p>
</div>
<div class="section" id="modifying-source-code">
<h2><span class="section-number">2.3. </span>Modifying source code<a class="headerlink" href="#modifying-source-code" title="Permalink to this headline">¶</a></h2>
<div class="section" id="source-code-directory-structure-and-repositories">
<h3><span class="section-number">2.3.1. </span>Source code directory structure and repositories<a class="headerlink" href="#source-code-directory-structure-and-repositories" title="Permalink to this headline">¶</a></h3>
<p>Within a CESM checkout, after all components are obtained with the <code class="docutils literal notranslate"><span class="pre">manage_externals</span></code>
tool, CISM source code can be found in the directory <code class="docutils literal notranslate"><span class="pre">components/cism</span></code>. The source code
for CISM within CESM is contained in two separate git repositories:</p>
<ul class="simple">
<li><p>The code for CISM itself is in the directory rooted at
<code class="docutils literal notranslate"><span class="pre">components/cism/source_cism</span></code>. This is a git repository associated with the <a class="reference external" href="https://github.com/escomp/cism">CISM
GitHub repository</a>.</p></li>
<li><p>The wrapper code for connecting CISM with CESM is in the other subdirectories of
<code class="docutils literal notranslate"><span class="pre">components/cism</span></code>. This top-level directory is a git repository associated with the
<a class="reference external" href="https://github.com/escomp/cism-wrapper/">CISM-wrapper GitHub repository</a>.</p></li>
</ul>
<p>Other subdirectories of the top-level CISM-wrapper code are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">source_glc</span></code>, which contains much of the logic for driving CISM via CESM</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">drivers</span></code>, which contains the code for coupling with CESM via both the NUOPC and MCT coupling
frameworks</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bld</span></code>, which mainly consists of code and xml files needed to create the namelist and
configuration files. Note that the actual build of the model is handled by files in
<code class="docutils literal notranslate"><span class="pre">cime_config</span></code>. The most important files in <code class="docutils literal notranslate"><span class="pre">bld</span></code> are <code class="docutils literal notranslate"><span class="pre">build-namelist</span></code> and the xml
files in the <code class="docutils literal notranslate"><span class="pre">namelist_files</span></code> subdirectory, which describe all possible namelist /
configuration settings and their default values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cime_config</span></code>, which contains build scripts and configuration files used by <a class="reference external" href="http://esmci.github.io/cime/">CIME</a> (the scripting and infrastructure of CESM).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tools</span></code>, which contains tools (now somewhat obsolete) for generating land/ice-sheet
grid overlap files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test</span></code>, which contains code (now somewhat obsolete) for testing some parts of the
source code</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mpi</span></code> and <code class="docutils literal notranslate"><span class="pre">serial</span></code>, which have appropriate versions of source code that can be used
for parallel and serial runs, respectively. The <code class="docutils literal notranslate"><span class="pre">serial</span></code> directory is obsolete; now
the <code class="docutils literal notranslate"><span class="pre">mpi</span></code> directory is used even when running on a single processor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">manage_externals</span></code>, which is the same tool that CESM uses to obtain its
components. This instance of the tool can be used to obtain a working set of code when
cloning directly from the <a class="reference external" href="https://github.com/escomp/cism-wrapper/">CISM-wrapper GitHub repository</a>.</p></li>
</ul>
<p>There are two ways to modify source code for a CESM case:</p>
<ol class="arabic simple">
<li><p>Changing code in-place in the source tree</p></li>
<li><p>Using SourceMods</p></li>
</ol>
<p>These two methods are described in more detail below.</p>
<div class="section" id="changing-code-in-place-in-the-source-tree">
<h4><span class="section-number">2.3.1.1. </span>Changing code in-place in the source tree<a class="headerlink" href="#changing-code-in-place-in-the-source-tree" title="Permalink to this headline">¶</a></h4>
<p>Changing code in-place allows you to make a git branch of the source code and do your work
leveraging the power and convenience of git. As noted above, there are two separate git
repositories making up CISM within CESM. If you need to modify code both in CISM itself
and in the CISM-wrapper, you will need to create a separate git branch for each (as well
as a separate GitHub fork of each repository if you want to push your work up to GitHub).</p>
<p>This method is best for changes that have some of these characteristics:</p>
<ul class="simple">
<li><p>Long-term developments</p></li>
<li><p>Incremental changes towards a final solution</p></li>
<li><p>Changes that apply to many cases</p></li>
<li><p>Changes that touch many files</p></li>
<li><p>Any change intended to eventually come back to master</p></li>
</ul>
</div>
<div class="section" id="using-sourcemods">
<h4><span class="section-number">2.3.1.2. </span>Using SourceMods<a class="headerlink" href="#using-sourcemods" title="Permalink to this headline">¶</a></h4>
<p>Within a case, there is a <code class="docutils literal notranslate"><span class="pre">SourceMods</span></code> directory that can contain modified source code
that applies to that specific case. The location for modified CISM files depends on
whether the files are part of the CISM code itself or part of the CISM-wrapper code. For
any source code that appears in the <code class="docutils literal notranslate"><span class="pre">source_cism</span></code> subdirectory of <code class="docutils literal notranslate"><span class="pre">components/cism</span></code>,
the modified file should go in <code class="docutils literal notranslate"><span class="pre">$CASEROOT/SourceMods/src.cism/source_cism</span></code>. For any
other source code (e.g., modifications to code from <code class="docutils literal notranslate"><span class="pre">source_glc</span></code>), the modified file
should go directly in <code class="docutils literal notranslate"><span class="pre">$CASEROOT/SourceMods/src.cism</span></code>. (C++ code in the <code class="docutils literal notranslate"><span class="pre">source_cism</span></code>
directory can NOT be modified via SourceMods; this C++ code must be modified in-place in
the main source code directory.) Once the modified files are in place, the code can be
rebuilt. The files in the SourceMods directories automatically replace the files of the
same name in the model directories.</p>
<p>This method is suitable for changes that have these characteristics:</p>
<ul class="simple">
<li><p>Short-term developments (merging in new changes from master is a pain and very
error-prone: you don’t have the version control system to help you keep track of your
changes over time)</p></li>
<li><p>Changes that apply to just one or two cases</p></li>
<li><p>Changes that touch just a few files</p></li>
</ul>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="b-compsets.html" class="btn btn-neutral float-right" title="3. Running the fully-coupled ice sheet model within CESM: B compsets" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="introduction.html" class="btn btn-neutral" title="1. Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Gunter Leguy, William Lipscomb, Bill Sacks.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
     
<script>var version_json_loc = "../../versions.json";</script>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="_static/pop_ver.js"></script>
    

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>